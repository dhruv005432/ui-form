<div class="change-password-container">
  <div class="container py-5">
    <!-- Page Header -->
    <div class="row justify-content-center mb-4" data-aos="fade-down">
      <div class="col-md-8 text-center">
        <h1 class="display-4 fw-bold text-primary mb-3">
          <i class="fas fa-lock me-3"></i>Change Password
        </h1>
        <p class="lead text-muted">
          Update your account password to enhance security. Choose a strong, unique password that you haven't used before.
        </p>
      </div>
    </div>

    <!-- Main Content -->
    <div class="row justify-content-center">
      <div class="col-md-10 col-lg-8">
        <div class="card shadow-lg border-0" data-aos="fade-up">
          <div class="card-body p-5">
            <!-- Security Image Section -->
            <div class="text-center mb-4" data-aos="zoom-in" data-aos-delay="200">
              <img 
                src="https://images.unsplash.com/photo-1556155092-8707de31f9c4" 
                alt="Security" 
                class="img-fluid rounded-3 security-image"
                style="max-height: 200px; object-fit: cover;"
              >
            </div>

            <!-- Change Password Form -->
            <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
              <!-- Current Password Field -->
              <div class="mb-4" data-aos="fade-up" data-aos-delay="300">
                <label for="currentPassword" class="form-label fw-semibold">
                  <i class="fas fa-key me-2"></i>Current Password
                </label>
                <div class="input-group">
                  <input 
                    type="{{ hideCurrentPassword ? 'password' : 'text' }}"
                    class="form-control form-control-lg"
                    id="currentPassword"
                    formControlName="currentPassword"
                    placeholder="Enter your current password"
                    [ngClass]="{ 'is-invalid': changePasswordForm.get('currentPassword')?.invalid && changePasswordForm.get('currentPassword')?.touched }"
                  >
                  <button 
                    type="button" 
                    class="btn btn-outline-secondary"
                    (click)="togglePasswordVisibility('current')"
                  >
                    <i class="fas {{ hideCurrentPassword ? 'fa-eye' : 'fa-eye-slash' }}"></i>
                  </button>
                </div>
                <div class="invalid-feedback d-block" *ngIf="getErrorMessage('currentPassword')">
                  {{ getErrorMessage('currentPassword') }}
                </div>
              </div>

              <!-- New Password Field -->
              <div class="mb-4" data-aos="fade-up" data-aos-delay="400">
                <label for="newPassword" class="form-label fw-semibold">
                  <i class="fas fa-lock me-2"></i>New Password
                </label>
                <div class="input-group">
                  <input 
                    type="{{ hideNewPassword ? 'password' : 'text' }}"
                    class="form-control form-control-lg"
                    id="newPassword"
                    formControlName="newPassword"
                    placeholder="Enter your new password"
                    [ngClass]="{ 'is-invalid': changePasswordForm.get('newPassword')?.invalid && changePasswordForm.get('newPassword')?.touched }"
                  >
                  <button 
                    type="button" 
                    class="btn btn-outline-secondary"
                    (click)="togglePasswordVisibility('new')"
                  >
                    <i class="fas {{ hideNewPassword ? 'fa-eye' : 'fa-eye-slash' }}"></i>
                  </button>
                </div>
                <div class="invalid-feedback d-block" *ngIf="getErrorMessage('newPassword')">
                  {{ getErrorMessage('newPassword') }}
                </div>

                <!-- Password Strength Indicator -->
                <div class="mt-2" *ngIf="changePasswordForm.get('newPassword')?.value">
                  <div class="d-flex justify-content-between align-items-center mb-1">
                    <small class="text-muted">Password Strength:</small>
                    <small class="fw-semibold" [style.color]="getPasswordStrength(changePasswordForm.get('newPassword')?.value).color">
                      {{ getPasswordStrength(changePasswordForm.get('newPassword')?.value).label }}
                    </small>
                  </div>
                  <div class="progress" style="height: 4px;">
                    <div 
                      class="progress-bar" 
                      [style.width.%]="(getPasswordStrength(changePasswordForm.get('newPassword')?.value).score / 6) * 100"
                      [style.background-color]="getPasswordStrength(changePasswordForm.get('newPassword')?.value).color"
                    ></div>
                  </div>
                </div>

                <!-- Password Requirements -->
                <div class="mt-2">
                  <small class="text-muted">Password must contain:</small>
                  <div class="row mt-1">
                    <div class="col-6">
                      <small class="d-block" [class.text-success]="hasLowercase(changePasswordForm.get('newPassword')?.value)" [class.text-muted]="!hasLowercase(changePasswordForm.get('newPassword')?.value)">
                        <i class="fas fa-check-circle me-1" *ngIf="hasLowercase(changePasswordForm.get('newPassword')?.value)"></i>
                        <i class="fas fa-circle me-1" *ngIf="!hasLowercase(changePasswordForm.get('newPassword')?.value)"></i>
                        Lowercase letter
                      </small>
                      <small class="d-block" [class.text-success]="hasUppercase(changePasswordForm.get('newPassword')?.value)" [class.text-muted]="!hasUppercase(changePasswordForm.get('newPassword')?.value)">
                        <i class="fas fa-check-circle me-1" *ngIf="hasUppercase(changePasswordForm.get('newPassword')?.value)"></i>
                        <i class="fas fa-circle me-1" *ngIf="!hasUppercase(changePasswordForm.get('newPassword')?.value)"></i>
                        Uppercase letter
                      </small>
                    </div>
                    <div class="col-6">
                      <small class="d-block" [class.text-success]="hasNumber(changePasswordForm.get('newPassword')?.value)" [class.text-muted]="!hasNumber(changePasswordForm.get('newPassword')?.value)">
                        <i class="fas fa-check-circle me-1" *ngIf="hasNumber(changePasswordForm.get('newPassword')?.value)"></i>
                        <i class="fas fa-circle me-1" *ngIf="!hasNumber(changePasswordForm.get('newPassword')?.value)"></i>
                        Number
                      </small>
                      <small class="d-block" [class.text-success]="hasSpecialChar(changePasswordForm.get('newPassword')?.value)" [class.text-muted]="!hasSpecialChar(changePasswordForm.get('newPassword')?.value)">
                        <i class="fas fa-check-circle me-1" *ngIf="hasSpecialChar(changePasswordForm.get('newPassword')?.value)"></i>
                        <i class="fas fa-circle me-1" *ngIf="!hasSpecialChar(changePasswordForm.get('newPassword')?.value)"></i>
                        Special character
                      </small>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Confirm Password Field -->
              <div class="mb-4" data-aos="fade-up" data-aos-delay="500">
                <label for="confirmPassword" class="form-label fw-semibold">
                  <i class="fas fa-lock me-2"></i>Confirm New Password
                </label>
                <div class="input-group">
                  <input 
                    type="{{ hideConfirmPassword ? 'password' : 'text' }}"
                    class="form-control form-control-lg"
                    id="confirmPassword"
                    formControlName="confirmPassword"
                    placeholder="Confirm your new password"
                    [ngClass]="{ 'is-invalid': changePasswordForm.get('confirmPassword')?.invalid && changePasswordForm.get('confirmPassword')?.touched }"
                  >
                  <button 
                    type="button" 
                    class="btn btn-outline-secondary"
                    (click)="togglePasswordVisibility('confirm')"
                  >
                    <i class="fas {{ hideConfirmPassword ? 'fa-eye' : 'fa-eye-slash' }}"></i>
                  </button>
                </div>
                <div class="invalid-feedback d-block" *ngIf="getErrorMessage('confirmPassword')">
                  {{ getErrorMessage('confirmPassword') }}
                </div>
              </div>

              <!-- Form Level Errors -->
              <div class="alert alert-danger" *ngIf="getFormErrorMessage()">
                <i class="fas fa-exclamation-triangle me-2"></i>
                {{ getFormErrorMessage() }}
              </div>

              <!-- Action Buttons -->
              <div class="d-grid gap-3 d-md-flex justify-content-md-end" data-aos="zoom-in" data-aos-delay="600">
                <button 
                  type="button" 
                  class="btn btn-outline-secondary btn-lg px-4"
                  (click)="onCancel()"
                  [disabled]="isSubmitting"
                >
                  <i class="fas fa-arrow-left me-2"></i>Back to Profile
                </button>
                <button 
                  type="submit" 
                  class="btn btn-primary btn-lg px-4"
                  [disabled]="isSubmitting || changePasswordForm.invalid"
                >
                  <span *ngIf="!isSubmitting">
                    <i class="fas fa-save me-2"></i>Update Password
                  </span>
                  <span *ngIf="isSubmitting">
                    <i class="fas fa-spinner fa-spin me-2"></i>Updating...
                  </span>
                </button>
              </div>
            </form>

            <!-- Security Tips -->
            <div class="mt-5 p-4 bg-light rounded-3" data-aos="fade-up" data-aos-delay="700">
              <h5 class="fw-semibold mb-3">
                <i class="fas fa-shield-alt me-2 text-primary"></i>Security Tips
              </h5>
              <ul class="mb-0">
                <li class="mb-2">Use a unique password that you haven't used before</li>
                <li class="mb-2">Avoid using personal information like birthdays or names</li>
                <li class="mb-2">Consider using a password manager to store your passwords securely</li>
                <li class="mb-0">Enable two-factor authentication for additional security</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
